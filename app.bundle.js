!function(e){function t(t){for(var o,a,s=t[0],l=t[1],h=t[2],d=0,u=[];d<s.length;d++)a=s[d],i[a]&&u.push(i[a][0]),i[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(c&&c(t);u.length;)u.shift()();return r.push.apply(r,h||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(o=!1)}o&&(r.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},i={0:0};var r=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var h=0;h<s.length;h++)t(s[h]);var c=l;r.push([27,1]),n()}([,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=window.AFRAME.THREE;t.DARK_GRAY=new o.Color(5658202),t.REPUBLICAN_RED=new o.Color(15277326),t.DEMOCRAT_BLUE=new o.Color(2302054),t.LIBERTARIAN_GOLD=new o.Color(15058433),t.GREEN_PARTY_GREEN=new o.Color(43356),t.INDEPENDENT_PURPLE=new o.Color(9699539),t.YEARS=["2016","2012","2008","2004"]},,,,,,,,,,function(e,t,n){"use strict";n(3);var o=window.AFRAME;o.registerComponent("help",{init:function(){this.superHands=document.querySelector("[progressive-controls]"),this.handleControllerChange=this.handleControllerChange.bind(this),this.superHands.addEventListener("controller-progressed",this.handleControllerChange),this.hideHelp=this.hideHelp.bind(this),this.el.sceneEl.addEventListener("year-changed",this.hideHelp),this.helpEls={}},remove:function(){this.superHands.removeEventListener("controller-progressed",this.handleControllerChange),this.el.sceneEl.removeEventListener("year-changed",this.hideHelp),this.clearHelpEls()},handleControllerChange:function(e){"gaze"===e.detail.level?this.setupGazeHelp(e.target):"right"===e.detail.hand?this.setupRightPointerHelp(e.target):this.setupLeftPointerHelp(e.target),this.showHelp()},createTextPanel:function(e){var t=document.createElement("a-entity");return t.setAttribute("geometry",{primitive:"plane",height:"auto"}),t.setAttribute("material","shader","flat"),t.setAttribute("material","color","white"),t.setAttribute("material","opacity","0.75"),t.setAttribute("text","color","black"),t.setAttribute("text","value",e),t},setupGazeHelp:function(e){this.clearPointerHelpEls();var t="Gaze at something for 1 second to select it.";o.utils.device.isMobile()||(t+="\nUse the w-a-s-d keys to move around.");var n=this.createTextPanel(t);n.setAttribute("text","wrapCount","15"),n.setAttribute("geometry","width","0.5"),n.setAttribute("text","align","center"),n.setAttribute("position","0.3 0 -2"),e.components["progressive-controls"].caster.parentEl.appendChild(n),this.helpEls.gazeHelp=n},setupRightPointerHelp:function(e){this.clearGazeHelpEl();var t=this.createTextPanel("To select something, point the laser at it and pull the trigger button.\n\n        To move the map, point the laser at it, hold down the grip buttons, and move the controller.");t.setAttribute("geometry","width","0.18"),t.setAttribute("text","wrapCount","20"),t.setAttribute("text","align","left"),t.setAttribute("position","0.15 0 0.05"),t.setAttribute("rotation","-90 0 0"),e.components["progressive-controls"].right.appendChild(t),this.helpEls.rightPointerHelpEl=t},setupLeftPointerHelp:function(e){this.clearGazeHelpEl();var t=this.createTextPanel("To resize the map, point both the lasers at the map, hold down both triggers, and move the controllers apart or together.\n\n        To resize and move the map at the same time, point both the lasers at the map, hold down the grip buttons on both controllers, and move the controllers around.");t.setAttribute("geometry","width","0.18"),t.setAttribute("text","wrapCount","20"),t.setAttribute("text","align","left"),t.setAttribute("position","-0.15 0 0.05"),t.setAttribute("rotation","-90 0 0"),e.components["progressive-controls"].left.appendChild(t),this.helpEls.leftPointerHelpEl=t},showHelp:function(){var e=this;Object.keys(this.helpEls).forEach(function(t){e.helpEls[t].setAttribute("visible",!0)})},hideHelp:function(){var e=this;Object.keys(this.helpEls).forEach(function(t){e.helpEls[t].setAttribute("visible",!1)})},clearGazeHelpEl:function(){this.helpEls.gazeHelp&&(this.helpEls.gazeHelp.parentEl.removeChild(this.helpEls.gazeHelp),delete this.helpEls.gazeHelp)},clearPointerHelpEls:function(){this.helpEls.rightPointerHelpEl&&(this.helpEls.rightPointerHelpEl.parentEl.removeChild(this.helpEls.rightPointerHelpEl),delete this.helpEls.rightPointerHelpEl),this.helpEls.leftPointerHelpEl&&(this.helpEls.leftPointerHelpEl.parentEl.removeChild(this.helpEls.leftPointerHelpEl),delete this.helpEls.leftPointerHelpEl)},clearHelpEls:function(){this.clearGazeHelpEl(),this.clearPointerHelpEls()}})},function(e,t,n){"use strict";n(3);var o=n(7);window.AFRAME.registerComponent("year-selector",{schema:{selectedYear:{type:"string"},selectionColor:{type:"color",default:"#E5C601"}},init:function(){this.handleHoverStart=this.handleHoverStart.bind(this),this.handleHoverEnd=this.handleHoverEnd.bind(this),this.handleStateChange=this.handleStateChange.bind(this),this.createButtons()},update:function(e){var t=this;this.data.selectedYear===e.selectedYear&&this.data.selectionColor===e.selectionColor||o.YEARS.forEach(function(e){var n=t.buttons[e];e===t.data.selectedYear?n.setAttribute("material","color",t.data.selectionColor):n.setAttribute("material","color","#FFFFFF")}),this.data.selectedYear!==e.selectedYear&&this.el.emit("year-changed",{year:this.data.selectedYear},!0)},remove:function(){var e=this;o.YEARS.forEach(function(t){var n=e.buttons[t].querySelector(".border");n.removeEventListener("hover-start",e.handleHoverStart),n.removeEventListener("hover-end",e.handleHoverEnd)})},handleStateChange:function(e){var t=this;"clicked"===e.detail&&o.YEARS.forEach(function(n){var o=t.buttons[n];o===e.target?(o.setAttribute("material","color",t.data.selectionColor),t.el.setAttribute("year-selector","selectedYear",n)):o.setAttribute("material","color","#FFFFFF")})},handleHoverStart:function(e){e.target.setAttribute("material","color",this.data.selectionColor),e.detail.hand.components.haptics&&e.detail.hand.components.haptics.pulse(.2,10)},handleHoverEnd:function(e){e.target.setAttribute("material","color","black")},createButtons:function(){var e=this,t=0;this.buttons={},o.YEARS.forEach(function(n){var o=document.createElement("a-entity");o.setAttribute("geometry",{primitive:"plane",height:.25,width:.5}),o.setAttribute("class","selectable"),o.setAttribute("clickable",{}),o.setAttribute("onclick",'this.emit("grab-start", {}); this.emit("grab-end", {});'),o.addEventListener("stateadded",e.handleStateChange),o.setAttribute("position",t+" 0 0"),o.setAttribute("material","shader","flat"),o.setAttribute("material","color","#FFFFFF"),o.setAttribute("text","value",n),o.setAttribute("text","color","black"),o.setAttribute("text","wrapCount","4"),o.setAttribute("text","align","center"),o.setAttribute("text","zOffset","0.05");var i=document.createElement("a-plane");i.setAttribute("class","border"),i.setAttribute("hoverable",{}),i.setAttribute("position","0 0 -0.005"),i.setAttribute("material","shader","flat"),i.setAttribute("material","color","black"),i.setAttribute("height",.29),i.setAttribute("width",.54),i.addEventListener("hover-start",e.handleHoverStart),i.addEventListener("hover-end",e.handleHoverEnd),o.appendChild(i),e.buttons[n]=o,e.el.appendChild(o),t+=.55})}})},function(e,t,n){"use strict";n(3);var o=n(2);window.AFRAME.registerComponent("selection-info",{schema:{state:{type:"string"},candidate:{type:"string"},party:{type:"string"},votes:{type:"number"},totalVotes:{type:"number"},percentage:{type:"number"},color:{type:"color"}},init:function(){this.voteFormatter=(0,o.format)(","),this.totalVoteFormatter=(0,o.format)(".3s"),this.percentageFormatter=(0,o.format)(".3p")},getInfoText:function(){return this.data.state+"\n            "+this.data.candidate+" ("+this.data.party+")\n            "+this.voteFormatter(this.data.votes)+" votes\n            "+this.percentageFormatter(this.data.percentage)+" of "+this.totalVoteFormatter(this.data.totalVotes)+" total"}})},function(e,t,n){"use strict";n(3);var o=window.AFRAME,i=o.THREE;o.registerComponent("selection-handler",{init:function(){this.selectionBox=new i.Box3Helper(new i.Box3,"black"),this.selectionBox.visible=!1,this.el.setObject3D("selectionBox",this.selectionBox),this.stateBox=new i.Box3,this.infoPanelAnchorPosition=new i.Vector3,this.infoPanel=document.querySelector("#info-panel"),this.infoPanelText=document.querySelector("#info-panel-text"),this.infoPanelHighlight=document.querySelector("#info-panel-highlight"),this.superHands=document.querySelector("[progressive-controls]"),this.handleControllerChange=this.handleControllerChange.bind(this),this.superHands.addEventListener("controller-progressed",this.handleControllerChange),this.handleSelection=this.handleSelection.bind(this),this.turnSelectionOff=this.turnSelectionOff.bind(this),this.el.sceneEl.addEventListener("year-changed",this.turnSelectionOff)},handleControllerChange:function(e){"gaze"===e.detail.level?(this.el.removeEventListener("grab-end",this.handleSelection),this.el.addEventListener("click",this.handleSelection)):(this.el.removeEventListener("click",this.handleSelection),this.el.addEventListener("grab-end",this.handleSelection))},remove:function(){this.el.removeEventListener("click",this.handleSelection),this.el.removeEventListener("grab-end",this.handleSelection),this.superHands.removeEventListener("controller-progressed",this.handleControllerChange),this.el.sceneEl.removeEventListener("year-changed",this.turnSelectionOff)},handleSelection:function(e){var t=e.target;this.isAlreadySelected(t)?this.turnSelectionOff():this.isSelectable(t)&&this.setSelectionTo(t)},isAlreadySelected:function(e){return e===this.selected},isSelectable:function(e){return!!e.components["selection-info"]},setSelectionTo:function(e){this.selected=e;var t=this.selected.getObject3D("mesh");t.geometry.computeBoundingBox(),this.showSelectionBoxFor(t),this.showInfoPanel(t)},showSelectionBoxFor:function(e){var t=e.getWorldPosition(),n=this.el.object3D.worldToLocal(t),o=new i.Box3;o.setFromCenterAndSize(n,e.geometry.boundingBox.getSize()),this.selectionBox.box=o,this.selectionBox.visible=!0},showInfoPanel:function(){var e=this.selected.components["selection-info"];this.infoPanelText.setAttribute("value",e.getInfoText()),this.calculateInfoPanelAnchorPosition(),this.infoPanel.object3D.position.copy(this.infoPanelAnchorPosition),this.infoPanelHighlight.setAttribute("color","#"+e.data.color),this.infoPanel.object3D.visible=!0},calculateInfoPanelAnchorPosition:function(){this.stateBox.setFromObject(this.selected.parentEl.object3D),this.stateBox.getCenter(this.infoPanelAnchorPosition),this.infoPanelAnchorPosition.setY(this.stateBox.max.y+.75)},needsPositionUpdate:function(){return!this.infoPanel.object3D.position.equals(this.infoPanelAnchorPosition)},tick:function(){this.selected&&(this.calculateInfoPanelAnchorPosition(),this.needsPositionUpdate()&&this.infoPanel.object3D.position.copy(this.infoPanelAnchorPosition))},turnSelectionOff:function(){this.infoPanel.object3D.visible=!1,this.selectionBox.visible=!1,this.selected=null}})},function(e,t,n){"use strict";n(3);var o=window.AFRAME,i=o.THREE;o.registerComponent("hover-handler",{init:function(){this.hoverBox=new i.Box3Helper(new i.Box3,"darkgrey"),this.hoverBox.visible=!1,this.el.setObject3D("hoverBox",this.hoverBox),this.handleHoverStart=this.handleHoverStart.bind(this),this.el.addEventListener("hover-start",this.handleHoverStart),this.handleHoverEnd=this.handleHoverEnd.bind(this),this.el.addEventListener("hover-end",this.handleHoverEnd),this.el.sceneEl.addEventListener("year-changed",this.handleHoverEnd)},remove:function(){this.el.removeEventListener("hover-start",this.handleHoverStart),this.el.removeEventListener("hover-end",this.handleHoverEnd),this.el.sceneEl.removeEventListener("year-changed",this.handleHoverEnd)},handleHoverStart:function(e){if(this.selected=e.target,this.selected.components.hoverable){var t=this.selected.getObject3D("mesh"),n=t.getWorldPosition(),o=this.el.object3D.worldToLocal(n);t.geometry.computeBoundingBox();var r=new i.Box3;r.setFromCenterAndSize(o,t.geometry.boundingBox.getSize()),e.detail.hand.components.haptics&&e.detail.hand.components.haptics.pulse(.2,10),this.hoverBox.box=r,this.hoverBox.visible=!0}},handleHoverEnd:function(){this.hoverBox.visible=!1,this.selected=null}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(7));var i={"Trump, Donald J.":{firstName:"Donald J.",lastName:"Trump",party:"R",color:o.REPUBLICAN_RED},"Clinton, Hillary":{firstName:"Hillary",lastName:"Clinton",party:"D",color:o.DEMOCRAT_BLUE},"Johnson, Gary":{firstName:"Gary",lastName:"Johnson",party:"LIB",color:o.LIBERTARIAN_GOLD},"Stein, Jill":{firstName:"Jill",lastName:"Stein",party:"GRE",color:o.GREEN_PARTY_GREEN},"McMullin, Evan":{firstName:"Evan",lastName:"McMullin",party:"IND",color:o.INDEPENDENT_PURPLE},"Obama, Barack":{firstName:"Barak",lastName:"Obama",party:"D",color:o.DEMOCRAT_BLUE},"Romney, Mitt":{firstName:"Mitt",lastName:"Romney",party:"R",color:o.REPUBLICAN_RED},"McCain, John":{firstName:"John",lastName:"McCain",party:"R",color:o.REPUBLICAN_RED},"Nader, Ralph":{firstName:"Ralph",lastName:"Nader",party:"IND",color:o.INDEPENDENT_PURPLE},"Barr, Bob":{firstName:"Bob",lastName:"Barr",party:"LIB",color:o.LIBERTARIAN_GOLD},"Bush, George W.":{firstName:"George W.",lastName:"Bush",party:"R",color:o.REPUBLICAN_RED},"Kerry, John F.":{firstName:"John F.",lastName:"Kerry",party:"D",color:o.DEMOCRAT_BLUE},"Badnarik, Michael":{firstName:"Michael",lastName:"Badnarik",party:"LIB",color:o.LIBERTARIAN_GOLD}};t.default=i},function(e,t,n){"use strict";var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};n(3);var i,r=n(8),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(7)),s=n(22),l=(i=s)&&i.__esModule?i:{default:i};var h=window.AFRAME,c=h.THREE,d=new c.MeshBasicMaterial({visible:!1});h.registerComponent("cartogram-renderer",{dependencies:["geo-projection"],schema:{maxExtrudeHeight:{default:1.6}},init:function(){this.geoProjectionComponent=this.el.components["geo-projection"],this.system=this.el.sceneEl.systems["geo-projection"],this.handleGeoDataReady=this.handleGeoDataReady.bind(this),this.handleElectionDataReady=this.handleElectionDataReady.bind(this),this.el.addEventListener("geo-data-ready",this.handleGeoDataReady),this.el.addEventListener("election-data-loaded",this.handleElectionDataReady)},remove:function(){this.el.removeEventListener("geo-data-ready",this.handleGeoDataReady),this.el.removeEventListener("election-data-loaded",this.handleElectionDataReady),this.clearMap(!0)},update:function(e){this.data.maxExtrudeHeight!==e.maxExtrudeHeight&&this.render()},handleGeoDataReady:function(){this.render()},handleElectionDataReady:function(e){var t=e.detail;this.votesByFipsCode=t.votesByFipsCode,this.maxTotalVoters=t.maxTotalVoters,this.render()},isReady:function(){return!(!this.votesByFipsCode||!this.geoProjectionComponent.geoJson)},render:function(){var e=this;if(this.clearMap(),this.isReady()){var t=(0,r.scaleLinear)().domain([0,this.maxTotalVoters]).range([0,this.data.maxExtrudeHeight]),n={};this.geoProjectionComponent.geoJson.features.forEach(function(i){var r=e.votesByFipsCode[i.id],a=e.system.renderToContext(i,e.geoProjectionComponent.projection).toShapes(),s=0,h=document.createElement("a-entity");h.setAttribute("id","state-"+i.id),h.setAttribute("class","state-selection-mask"),r.forEach(function(e){var r=e.votes/e.totalVoters,u=t(e.votes);if(!n[e.name]){var p=l.default[e.name];n[e.name]=o({geometry:new c.Geometry},p)}var f=n[e.name],v=f.geometry,m=void 0;m="15"===i.id||"02"===i.id?function(e,t,n,o){var i={amount:e,bevelEnabled:!1},r=new c.Geometry;return t.forEach(function(e){var t=new c.ExtrudeGeometry(e,i);t.computeBoundingBox();var a=t.boundingBox.getCenter();t.center(),t.scale(n,n,1),t.translate(a.x,a.y,a.z+o),r.merge(t)}),r}(u,a,r,s):function(e,t,n,o){var i={amount:e,bevelEnabled:!1},r=new c.ExtrudeGeometry(t,i);r.computeBoundingBox();var a=r.boundingBox.getCenter();return r.center(),r.scale(n,n,1),r.translate(a.x,a.y,a.z+o),r}(u,a,r,s),v.merge(m);var E=f.firstName+" "+f.lastName,g={state:i.properties.name,candidate:E,party:f.party,votes:e.votes,percentage:r,totalVotes:e.totalVoters,color:f.color.getHexString()},b=function(e,t,n){var o=new c.BufferGeometry;o.fromGeometry(e),o.computeBoundingBox();var i=o.boundingBox.getCenter();o.translate(-i.x,-i.y,-i.z);var r=new c.Mesh(o,d);r.name=t;var a=document.createElement("a-entity");return a.setAttribute("id",t),a.setAttribute("position",i),a.setAttribute("class","selectable"),a.setAttribute("selection-info",n),a.setAttribute("hoverable",""),a.setObject3D("mesh",r),a}(m,i.id+"-"+f.lastName,g);h.appendChild(b),s+=u}),e.el.appendChild(h)}),Object.keys(n).forEach(function(t){var o=n[t],i=new c.BufferGeometry;i.fromGeometry(o.geometry);var r=new c.MeshLambertMaterial({color:o.color}),a=new c.Mesh(i,r);e.el.setObject3D(t,a)});var i=this.system.renderToContext(this.geoProjectionComponent.geoJson,this.geoProjectionComponent.projection),s=new c.BufferGeometry,h=i.toVertices();s.addAttribute("position",new c.Float32BufferAttribute(h,3));var u=new c.LineBasicMaterial({color:a.DARK_GRAY}),p=new c.LineSegments(s,u);this.el.setObject3D("lines",p)}},clearMap:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object.keys(this.el.object3DMap).forEach(function(n){!t&&["hoverBox","selectionBox","outlineMap"].includes(n)||e.el.removeObject3D(n)}),this.el.querySelectorAll(".state-selection-mask").forEach(function(t){e.el.removeChild(t)})}})},function(e){e.exports={state:"CA",totalVoters:14181604}},function(e,t,n){"use strict";n(3);var o,i=n(24),r=(o=i)&&o.__esModule?o:{default:o};window.AFRAME.registerComponent("election-data-loader",{schema:{year:{type:"string"}},init:function(){this.handleDataLoaded=this.handleDataLoaded.bind(this),this.handleYearChanged=this.handleYearChanged.bind(this),this.el.sceneEl.addEventListener("year-changed",this.handleYearChanged),this.yearText=document.querySelector("#year")},remove:function(){this.el.sceneEl.removeEventListener("year-changed",this.handleYearChanged)},update:function(e){var t=this;this.data.year&&this.data.year!==e.year&&fetch("assets/federalelections"+this.data.year+".json").then(function(e){return e.json()}).then(this.handleDataLoaded).then(function(){t.yearText.setAttribute("value",t.data.year)}).catch(function(e){console.error(e)})},handleYearChanged:function(e){this.el.setAttribute("election-data-loader","year",e.detail.year)},handleDataLoaded:function(e){var t=e.reduce(function(e,t){return e[t.fips]||(e[t.fips]=[]),e[t.fips].push(t),e},{}),n=r.default.totalVoters;this.el.emit("election-data-loaded",{votesByFipsCode:t,maxTotalVoters:n})}})},function(e,t,n){"use strict";n(3),n(13),n(10),n(14),n(12),n(11),n(25),n(23),n(21),n(20),n(19),n(18),n(17)},function(e,t,n){e.exports=n(26)}]);
//# sourceMappingURL=app.bundle.js.map